<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true" internalLogLevel="Off">

	<variable name="logDir" value="${basedir}/logs" />

	<targets>
		<target xsi:type="Console" name="console">
			<layout xsi:type="JsonLayout">
				<attribute name="ts"          layout="${date:universalTime=true:format=o}" />
				<attribute name="level"       layout="${level}" />
				<attribute name="logger"      layout="${logger}" />
				<attribute name="msg"         layout="${message}" />
				<attribute name="ex"          layout="${exception:format=tostring}" />
				<attribute name="traceId"     layout="${aspnet-traceidentifier}" />
				<attribute name="corrId"      layout="${scopeproperty:CorrelationId}" />
				<attribute name="method"      layout="${aspnet-request-method}" />
				<attribute name="path"        layout="${aspnet-request-url}" />
				<attribute name="clientIp"    layout="${aspnet-request-ip}" />
			</layout>
		</target>

		<target xsi:type="File" name="file"
				fileName="${logDir}/${shortdate}.log"
				archiveEvery="Day" archiveNumbering="Date"
				maxArchiveFiles="14" concurrentWrites="true" keepFileOpen="false">
			<layout xsi:type="JsonLayout">
				<attribute name="ts"       layout="${date:universalTime=true:format=o}" />
				<attribute name="level"    layout="${level}" />
				<attribute name="logger"   layout="${logger}" />
				<attribute name="msg"      layout="${message}" />
				<attribute name="ex"       layout="${exception:format=tostring}" />
				<attribute name="traceId"  layout="${aspnet-traceidentifier}" />
				<attribute name="corrId"   layout="${scopeproperty:CorrelationId}" />
				<attribute name="method"   layout="${aspnet-request-method}" />
				<attribute name="path"     layout="${aspnet-request-url}" />
			</layout>
		</target>
	</targets>

	<rules>
		<!-- giảm “noise” từ Microsoft.* -->
		<logger name="Microsoft.*" minlevel="Warn" writeTo="console,file" />
		<!-- log HttpClient & Ocelot rõ hơn -->
		<logger name="System.Net.Http.HttpClient.*" minlevel="Information" writeTo="console,file" />
		<logger name="Ocelot.*"                      minlevel="Information" writeTo="console,file" />
		<!-- app của mình -->
		<logger name="*" minlevel="Information" writeTo="console,file" />
	</rules>
</nlog>
